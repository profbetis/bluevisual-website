<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <link href="https://fonts.googleapis.com/css?family=Work+Sans:200,300,400" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400&amp;subset=latin-ext" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">

    
    <meta property="og:site_name" content="Blue Visual" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="en_US" />
    <meta name="robots" content="noodp"/>

    

      <title>Blue Visual - Edgewalker</title>
      <meta property="og:title" content="Blue Visual - Edgewalker" />
      <meta name="description" content="An example project that uses the output of the edgewalker.Algorithm The Edgewalker tool starts at a group of points, and walks along..."/>
      <meta property="og:description" content="An example project that uses the output of the edgewalker.Algorithm The Edgewalker tool starts at a group of points, and walks along..." />
      <link rel="canonical" href="http://bluevisual.tv/personal/edgewalker/" />
      <meta property="og:url" content="http://bluevisual.tv/personal/edgewalker/" />
      <meta property="og:image" content="http://bluevisual.tv//images/edgewalker-thumb.jpg" />

    
    
  </head>

  <body>

<a href="/"> <img src="/header.svg" id="header"> </a>


<a href="http://bluevisual.tv/" id="return">
  <span>Return        &lt;</span>
</a>

<div class="project">


  


<div class="header">
  <a href="http://bluevisual.tv/personal/edgewalker/">
    <div class="image" style="background-image: url('/images/edgewalker-thumb.jpg');" ></div>
  </a>

  <div class="info">
    <div class="title"><a href="http://bluevisual.tv/personal/edgewalker/">Edgewalker</a></div>
    <div class="subtitle">
      

      
        
          Nov 2018
        
      
    </div>
    <div class="tags">
      <div>Tags</div><a href="/tags/houdini"><div>houdini</div></a><a href="/tags/procedural"><div>procedural</div></a><a href="/tags/tool"><div>tool</div></a></div>
    <div class="tools">
      <div>Tools</div><div>Houdini</div></div>
  </div>
</div>


  
    <div class="proj-toc">
      <h2>Project Sections</h2>
      
        
        <h3><a href="#algorithm">Algorithm</a></h3>
      
        <span class="separator"> / </span>
        <h3><a href="#controls">Controls</a></h3>
      
        <span class="separator"> / </span>
        <h3><a href="#setup">Setup</a></h3>
      
        <span class="separator"> / </span>
        <h3><a href="#solver">Solver</a></h3>
      
        <span class="separator"> / </span>
        <h3><a href="#post-process">Post-Process</a></h3>
      
    </div>
  

  <div class="content">

    

    
      

<div class="vimeo-container project-image">
  <iframe src="//player.vimeo.com/video/301523437?title=0&byline=0&portrait=0&color=00ccff" width="960" height="540" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen>
  </iframe><div class="caption">An example project that uses the output of the edgewalker.</div></div>


<h1 id="algorithm">Algorithm</h1>

<p>The Edgewalker tool starts at a group of points, and walks along edges to neighboring points to create an edge group or polyline.</p>

<div class="project-image" oncontextmenu="return false;">
  <label for="lightbox-toggle5"><img src="/images/edgewalker-05.jpg"></label><div class="caption">A progression of snapshots of the algorithm. A frame is skipped between each stage for demonstration purposes.</div></div>
<input type="checkbox" name="lightbox-toggle5" id="lightbox-toggle5" />
<div class="lightbox" oncontextmenu="return false;">
  <label for="lightbox-toggle5"><img src="/images/edgewalker-05.jpg"><div class="caption">A progression of snapshots of the algorithm. A frame is skipped between each stage for demonstration purposes.</div></label>
</div>


<p>While the look can seem similar to the Find Shortest Path SOP or perhaps Edge Network, those nodes don&rsquo;t avoid current edges and have many merges or splits.</p>

<p>For the above video I took the attribute created upon creating an edge called <code>path_time</code>. I capture a rest position after the final solve, then set the Y position to this attribute. After that I use a Clip SOP (as opposed to Blast) to smoothly remove any path geometry ahead of a certain amount and then return the rest position. I then pushed points away from the center based on their <code>path_time</code> attribute as well, giving some depth and layering to the final shape. Finally, instancing some spheres at corners and carve positions for some extra life.</p>

<h1 id="controls">Controls</h1>

<p>The controls are split up into three main groups that don&rsquo;t much affect the others.</p>

<p>One of the most powerful tools in this is the direction attribute, which lets you use a vector point attribute to guide the neighbor preference algorithm. This allows for very nice swirls and parallel pathing that can look natural and interesting.</p>

<div class="project-image" oncontextmenu="return false;">
  <label for="lightbox-toggle4"><img src="/images/edgewalker-04.jpg"></label><div class="caption">The three tabs of controls.</div></div>
<input type="checkbox" name="lightbox-toggle4" id="lightbox-toggle4" />
<div class="lightbox" oncontextmenu="return false;">
  <label for="lightbox-toggle4"><img src="/images/edgewalker-04.jpg"><div class="caption">The three tabs of controls.</div></label>
</div>


<h1 id="setup">Setup</h1>

<p>The setup involves a few basic things, like creating the initial starting group, creating attributes, but most importantly doing some heavy calculations in parallel before the solver, which has to process things linearly do avoid racing problems.</p>

<div class="project-image" oncontextmenu="return false;">
  <label for="lightbox-toggle1"><img src="/images/edgewalker-01.jpg"></label><div class="caption">Network for the setup. After this it pipes into the Solver node.</div></div>
<input type="checkbox" name="lightbox-toggle1" id="lightbox-toggle1" />
<div class="lightbox" oncontextmenu="return false;">
  <label for="lightbox-toggle1"><img src="/images/edgewalker-01.jpg"><div class="caption">Network for the setup. After this it pipes into the Solver node.</div></label>
</div>


<p>Other things can be calculated once here instead of at every walk iteration. You can gather the neighbors once and also sort that list once to be easily looked up during the walk loop. If a certain neighbor is unavailable the neighbor list doesn&rsquo;t need to be recalculated, you just need to choose a different index.</p>

<p><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span><span class="lnt">33</span><span class="lnt">34</span><span class="lnt">35</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="c1">// Parameters
</span><span class="c1"></span><span class="kt">string</span> <span class="n">dir_type</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="s">&#34;../dir_type&#34;</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">dir_vec_style</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="s">&#34;../dir_vec_style&#34;</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">dir_attr</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="s">&#34;../dir_attr&#34;</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">norm_dir</span> <span class="p">=</span> <span class="n">chi</span><span class="p">(</span><span class="s">&#34;../norm_dir&#34;</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">rev_dir</span> <span class="p">=</span> <span class="n">chi</span><span class="p">(</span><span class="s">&#34;../rev_dir&#34;</span><span class="p">);</span>
<span class="n">vector</span> <span class="n">dir_vec</span> <span class="p">=</span> <span class="n">chv</span><span class="p">(</span><span class="s">&#34;../dir_vec&#34;</span><span class="p">);</span>

<span class="c1">// Pre-process the direction vector
</span><span class="c1"></span><span class="n">vector</span> <span class="n">dir</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">dir_type</span> <span class="p">==</span> <span class="s">&#34;vec&#34;</span> <span class="p">){</span> <span class="n">dir</span> <span class="p">=</span> <span class="n">dir_vec</span><span class="p">;</span> <span class="p">}</span>
<span class="k">else</span><span class="p">{</span>
    <span class="n">dir</span> <span class="p">=</span> <span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">dir_attr</span><span class="p">,</span> <span class="n">@ptnum</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">norm_dir</span> <span class="p">){</span> <span class="n">dir</span> <span class="p">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">dir</span><span class="p">);</span> <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">rev_dir</span> <span class="p">){</span> <span class="n">dir</span> <span class="p">*=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span> <span class="n">dir_vec_style</span> <span class="p">==</span> <span class="s">&#34;local&#34;</span> <span class="p">){</span>
    <span class="n">dir</span> <span class="p">*=</span> <span class="n">@N</span><span class="p">;</span>
<span class="p">}</span>

<span class="cm">/* Compute dot product between the direction to each neighbor
</span><span class="cm">and the current point&#39;s direction attribute */</span>
<span class="kt">int</span> <span class="n">nbs</span><span class="na">[]</span> <span class="p">=</span> <span class="n">i</span><span class="na">[]</span><span class="n">@neighborhood</span><span class="p">;</span> <span class="c1">// Neighborhood
</span><span class="c1"></span><span class="kt">float</span> <span class="n">values</span><span class="na">[]</span><span class="p">;</span> <span class="c1">// Array to store the values to rank neighbors by
</span><span class="c1"></span><span class="k">foreach</span><span class="p">(</span> <span class="kt">int</span> <span class="n">nbpt</span><span class="p">;</span> <span class="n">nbs</span><span class="p">){</span>
    <span class="n">vector</span> <span class="n">nb_pos</span> <span class="p">=</span> <span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;P&#34;</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span>
    <span class="kt">float</span> <span class="n">dot</span> <span class="p">=</span> <span class="n">dot</span><span class="p">(</span><span class="n">normalize</span><span class="p">(</span><span class="n">nb_pos</span> <span class="p">-</span> <span class="n">@P</span><span class="p">),</span> <span class="n">dir</span><span class="p">);</span>
    <span class="n">push</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">dot</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Sort the neighborhood by dot product values via argsort
</span><span class="cm"> Note: argsort would normally return an ascending list so
</span><span class="cm"> we have to reverse it in order to get highest values first.*/</span>
<span class="n">i</span><span class="na">[]</span><span class="n">@neighborhood</span> <span class="p">=</span> <span class="n">reorder</span><span class="p">(</span><span class="n">nbs</span><span class="p">,</span> <span class="n">reverse</span><span class="p">(</span><span class="n">argsort</span><span class="p">(</span><span class="n">values</span><span class="p">)));</span></code></pre></td></tr></table>
</div>
</div>
<div class="caption">VEX code for the &#39;Sort By Direction&#39; node.</div>
</p>

<h1 id="solver">Solver</h1>

<p>The heart of the walk algorithm is to choose from a sorted list of candidate points and add the edge between them to an edge group. If there are no candidate points, start with a new point in a list of open points.</p>

<p>A few point attributes are necessary to solve this. One is a group of &ldquo;active&rdquo; points, pretty standard in most solver/growth algorithms. The other is a &ldquo;closed&rdquo; group. This evolved from a &ldquo;processed&rdquo; state that other algorithms have because I wanted points with only one connected edge to remain open to be closed later on by a path that finds it.</p>

<div class="project-image" oncontextmenu="return false;">
  <label for="lightbox-toggle2"><img src="/images/edgewalker-02.jpg"></label><div class="caption">Solver network with a bypass branch if there are no more paths to create or consider.</div></div>
<input type="checkbox" name="lightbox-toggle2" id="lightbox-toggle2" />
<div class="lightbox" oncontextmenu="return false;">
  <label for="lightbox-toggle2"><img src="/images/edgewalker-02.jpg"><div class="caption">Solver network with a bypass branch if there are no more paths to create or consider.</div></label>
</div>


<p>The walk has to be done in a non-parallel fashion since two points competing for the same point need to be able to find a resolution. One will take it, and the other won&rsquo;t see it as an option anymore. I&rsquo;ve been thinking about ways to make it parallel again though, at least for the most part since most points are not next to each other.</p>

<p><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span><span class="lnt">33</span><span class="lnt">34</span><span class="lnt">35</span><span class="lnt">36</span><span class="lnt">37</span><span class="lnt">38</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="c1">// Parameters
</span><span class="c1"></span><span class="kt">string</span> <span class="n">path_closing</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="s">&#34;../../../../path_closing&#34;</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">merging</span> <span class="p">=</span> <span class="n">chi</span><span class="p">(</span><span class="s">&#34;../../../../merging&#34;</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">pt</span> <span class="p">=</span> <span class="n">chi</span><span class="p">(</span><span class="s">&#34;../loop_meta/point&#34;</span><span class="p">);</span> <span class="c1">// Which point to process
</span><span class="c1"></span><span class="kt">int</span> <span class="n">nbs</span><span class="na">[]</span> <span class="p">=</span> <span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;neighborhood&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">);</span>

<span class="c1">// Gather candidate points
</span><span class="c1"></span><span class="kt">int</span> <span class="n">candidates</span><span class="na">[]</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">active_candidates</span><span class="na">[]</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">inactive_candidates</span><span class="na">[]</span><span class="p">;</span>
<span class="k">foreach</span><span class="p">(</span> <span class="kt">int</span> <span class="n">nbpt</span><span class="p">;</span> <span class="n">nbs</span> <span class="p">){</span>
    <span class="kt">int</span> <span class="n">closed</span> <span class="p">=</span> <span class="n">inpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">active</span> <span class="p">=</span> <span class="n">inpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">connected</span> <span class="p">=</span> <span class="n">inedgegroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;edges&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">no_closing</span> <span class="p">=</span> <span class="p">(</span><span class="n">path_closing</span> <span class="p">==</span> <span class="s">&#34;no_closing&#34;</span><span class="p">);</span>
    <span class="kt">int</span> <span class="n">offlimits</span> <span class="p">=</span> <span class="n">inpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;offlimits&#34;</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span> <span class="p">!(</span><span class="n">closed</span><span class="p">&amp;!</span><span class="n">merging</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">connected</span> <span class="p">&amp;&amp;</span> <span class="p">!(</span><span class="n">active</span><span class="p">&amp;&amp;</span><span class="n">no_closing</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">offlimits</span> <span class="p">){</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">path_closing</span> <span class="p">==</span> <span class="s">&#34;no_pref&#34;</span> <span class="p">||</span> <span class="n">no_closing</span> <span class="p">){</span> <span class="n">push</span><span class="p">(</span><span class="n">candidates</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span> <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">active</span> <span class="p">){</span> <span class="n">push</span><span class="p">(</span><span class="n">active_candidates</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span> <span class="p">}</span>
            <span class="k">else</span>        <span class="p">{</span> <span class="n">push</span><span class="p">(</span><span class="n">inactive_candidates</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">);</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span><span class="p">(</span> <span class="n">path_closing</span> <span class="p">==</span> <span class="s">&#34;close&#34;</span> <span class="p">){</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">len</span><span class="p">(</span><span class="n">active_candidates</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">){</span> <span class="n">candidates</span> <span class="p">=</span> <span class="n">active_candidates</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span> <span class="n">candidates</span> <span class="p">=</span> <span class="n">inactive_candidates</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span> <span class="n">path_closing</span> <span class="p">==</span> <span class="s">&#34;avoid&#34;</span> <span class="p">){</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">len</span><span class="p">(</span><span class="n">inactive_candidates</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">){</span> <span class="n">candidates</span> <span class="p">=</span> <span class="n">inactive_candidates</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span> <span class="n">candidates</span> <span class="p">=</span> <span class="n">active_candidates</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/* A candidate list is stored at the detail for efficient access since
</span><span class="cm">it&#39;s only used once in the next node and then discarded */</span>
<span class="n">setdetailattrib</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;candidates&#34;</span><span class="p">,</span> <span class="n">candidates</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<div class="caption">VEX code for the &#39;Get Candidates&#39; node, which generates a list of which neighbors can be connected to.</div>
</p>

<p><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span><span class="lnt">33</span><span class="lnt">34</span><span class="lnt">35</span><span class="lnt">36</span><span class="lnt">37</span><span class="lnt">38</span><span class="lnt">39</span><span class="lnt">40</span><span class="lnt">41</span><span class="lnt">42</span><span class="lnt">43</span><span class="lnt">44</span><span class="lnt">45</span><span class="lnt">46</span><span class="lnt">47</span><span class="lnt">48</span><span class="lnt">49</span><span class="lnt">50</span><span class="lnt">51</span><span class="lnt">52</span><span class="lnt">53</span><span class="lnt">54</span><span class="lnt">55</span><span class="lnt">56</span><span class="lnt">57</span><span class="lnt">58</span><span class="lnt">59</span><span class="lnt">60</span><span class="lnt">61</span><span class="lnt">62</span><span class="lnt">63</span><span class="lnt">64</span><span class="lnt">65</span><span class="lnt">66</span><span class="lnt">67</span><span class="lnt">68</span><span class="lnt">69</span><span class="lnt">70</span><span class="lnt">71</span><span class="lnt">72</span><span class="lnt">73</span><span class="lnt">74</span><span class="lnt">75</span><span class="lnt">76</span><span class="lnt">77</span><span class="lnt">78</span><span class="lnt">79</span><span class="lnt">80</span><span class="lnt">81</span><span class="lnt">82</span><span class="lnt">83</span><span class="lnt">84</span><span class="lnt">85</span><span class="lnt">86</span><span class="lnt">87</span><span class="lnt">88</span><span class="lnt">89</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="c1">// Parameters
</span><span class="c1"></span><span class="kt">string</span> <span class="n">pre</span> <span class="p">=</span> <span class="s">&#34;../../../../&#34;</span><span class="p">;</span>

<span class="kt">string</span> <span class="n">new_path_behavior</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;new_path_behavior&#34;</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">deadend_behavior</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;deadend_behavior&#34;</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">path_closing</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;path_closing&#34;</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">do_time_attr</span> <span class="p">=</span> <span class="n">chi</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;do_time_attr&#34;</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">time_attr</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;time_attr&#34;</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">do_dist_attr</span> <span class="p">=</span> <span class="n">chi</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;do_dist_attr&#34;</span><span class="p">);</span>
<span class="kt">string</span> <span class="n">dist_attr</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;dist_attr&#34;</span><span class="p">);</span>

<span class="kt">float</span> <span class="n">seed</span> <span class="p">=</span> <span class="n">ch</span><span class="p">(</span><span class="n">pre</span><span class="p">+</span><span class="s">&#34;seed&#34;</span><span class="p">);</span>

<span class="kt">float</span> <span class="n">dop_time</span> <span class="p">=</span> <span class="n">chf</span><span class="p">(</span><span class="s">&#34;doptime&#34;</span><span class="p">);</span>
<span class="kt">float</span> <span class="n">dop_time_delta</span> <span class="p">=</span> <span class="n">chf</span><span class="p">(</span><span class="s">&#34;doptimedelta&#34;</span><span class="p">);</span>


<span class="kt">int</span> <span class="n">pt</span> <span class="p">=</span> <span class="n">chi</span><span class="p">(</span><span class="s">&#34;../loop_meta/point&#34;</span><span class="p">);</span> <span class="c1">// Which point to process
</span><span class="c1"></span><span class="kt">int</span> <span class="n">next</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span> <span class="c1">// Initialize next point index
</span><span class="c1"></span><span class="kt">int</span> <span class="n">candidates</span><span class="na">[]</span> <span class="p">=</span> <span class="n">detail</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;candidates&#34;</span><span class="p">);</span>


<span class="kt">int</span> <span class="n">deadend</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
<span class="k">if</span><span class="p">(</span> <span class="n">len</span><span class="p">(</span><span class="n">candidates</span><span class="p">)</span> <span class="p">==</span> <span class="m">0</span> <span class="p">){</span> <span class="n">deadend</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="p">}</span> <span class="c1">// If all neighbors are unmatchable, deadend
</span><span class="c1"></span>
<span class="k">if</span><span class="p">(</span> <span class="p">!</span><span class="n">deadend</span> <span class="p">){</span>
    <span class="n">next</span> <span class="p">=</span> <span class="n">candidates</span><span class="na">[0]</span><span class="p">;</span> <span class="c1">// Choose the first element in the candidate list
</span><span class="c1"></span>
    <span class="c1">// Apply Path Time attribute to the new point
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">do_time_attr</span> <span class="p">&amp;&amp;</span> <span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">time_attr</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">){</span>
        <span class="n">setpointattrib</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">time_attr</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">dop_time</span> <span class="p">+</span> <span class="n">dop_time_delta</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// Apply Path Distance attribute to the new point
</span><span class="c1"></span>    <span class="k">if</span><span class="p">(</span> <span class="n">do_time_attr</span> <span class="p">&amp;&amp;</span> <span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">dist_attr</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">){</span>
        <span class="kt">float</span> <span class="n">dist</span> <span class="p">=</span> <span class="n">distance</span><span class="p">(</span><span class="n">vector</span><span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;P&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">)),</span> <span class="n">vector</span><span class="p">(</span><span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;P&#34;</span><span class="p">,</span> <span class="n">next</span><span class="p">)));</span>
        <span class="n">setpointattrib</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">dist_attr</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="n">dist</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">setedgegroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;edges&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">// Connect the points
</span><span class="c1"></span>    <span class="n">setdetailattrib</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;next_pt&#34;</span><span class="p">,</span> <span class="n">next</span><span class="p">);</span>
<span class="p">}</span>


<span class="c1">// If next point is an active point
</span><span class="c1"></span><span class="k">if</span><span class="p">(</span> <span class="n">inpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">){</span>
    <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
    <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
    <span class="n">deadend</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span> <span class="c1">// Path is now closed
</span><span class="c1"></span><span class="p">}</span>
<span class="c1">// Otherwise
</span><span class="c1"></span><span class="k">else</span> <span class="p">{</span>
    <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">next</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">// Set next point to active
</span><span class="c1"></span>
    <span class="k">if</span><span class="p">(</span> <span class="n">new_path_behavior</span> <span class="p">==</span> <span class="s">&#34;one&#34;</span> <span class="p">){</span> <span class="c1">// Prevent branching if appropriate
</span><span class="c1"></span>        <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span> <span class="c1">// Set self to inactive
</span><span class="c1"></span>    <span class="p">}</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">path_closing</span> <span class="p">==</span> <span class="s">&#34;no_closing&#34;</span> <span class="p">){</span>
        <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">// Set self to closed
</span><span class="c1"></span>    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// If the next point is a closed point
</span><span class="c1"></span><span class="k">if</span><span class="p">(</span> <span class="n">inpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">next</span><span class="p">)</span> <span class="p">){</span>
    <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">// Set self to closed
</span><span class="c1"></span>    <span class="n">deadend</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// Deadend Behavior
</span><span class="c1"></span><span class="k">if</span><span class="p">(</span> <span class="n">deadend</span> <span class="p">){</span>
    <span class="k">if</span><span class="p">(</span> <span class="n">deadend_behavior</span> <span class="p">==</span> <span class="s">&#34;new&#34;</span> <span class="p">){</span>
        <span class="kt">int</span> <span class="n">open</span><span class="na">[]</span> <span class="p">=</span> <span class="n">detail</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="s">&#34;open_pts&#34;</span><span class="p">);</span> <span class="c1">// Available points to start at
</span><span class="c1"></span>        <span class="kt">int</span> <span class="n">num_open</span> <span class="p">=</span> <span class="n">len</span><span class="p">(</span><span class="n">open</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">num_open</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">){</span>
            <span class="kt">int</span> <span class="k">new</span> <span class="p">=</span> <span class="n">open</span><span class="na">[floor(rand(pt*14.23421+seed)*num_open)]</span><span class="p">;</span> <span class="c1">// Select random index
</span><span class="c1"></span>            <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="k">new</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">// Set selected point to active
</span><span class="c1"></span>        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span> <span class="c1">// Set self to inactive
</span><span class="c1"></span>    <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span> <span class="c1">// Set self to closed
</span><span class="c1"></span><span class="p">}</span>

<span class="k">if</span><span class="p">(</span> <span class="n">do_time_attr</span> <span class="p">&amp;&amp;</span> <span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">time_attr</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span> <span class="p">&lt;</span> <span class="m">0</span><span class="p">){</span>
    <span class="n">setpointattrib</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">time_attr</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">dop_time</span><span class="p">);</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<div class="caption">VEX code for the Walk node. This connects points to the next best point available.</div>
</p>

<p><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="lnt"> 1</span><span class="lnt"> 2</span><span class="lnt"> 3</span><span class="lnt"> 4</span><span class="lnt"> 5</span><span class="lnt"> 6</span><span class="lnt"> 7</span><span class="lnt"> 8</span><span class="lnt"> 9</span><span class="lnt">10</span><span class="lnt">11</span><span class="lnt">12</span><span class="lnt">13</span><span class="lnt">14</span><span class="lnt">15</span><span class="lnt">16</span><span class="lnt">17</span><span class="lnt">18</span><span class="lnt">19</span><span class="lnt">20</span><span class="lnt">21</span><span class="lnt">22</span><span class="lnt">23</span><span class="lnt">24</span><span class="lnt">25</span><span class="lnt">26</span><span class="lnt">27</span><span class="lnt">28</span><span class="lnt">29</span><span class="lnt">30</span><span class="lnt">31</span><span class="lnt">32</span><span class="lnt">33</span><span class="lnt">34</span><span class="lnt">35</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-cs" data-lang="cs"><span class="kt">string</span> <span class="n">path_closing</span> <span class="p">=</span> <span class="n">chs</span><span class="p">(</span><span class="s">&#34;../../../../path_closing&#34;</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">pts</span><span class="na">[]</span><span class="p">;</span>
<span class="n">push</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">chi</span><span class="p">(</span><span class="s">&#34;../loop_meta/point&#34;</span><span class="p">));</span>

<span class="kt">int</span> <span class="n">next_pt</span> <span class="p">=</span> <span class="n">detail</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;next_pt&#34;</span><span class="p">);</span>
<span class="k">if</span><span class="p">(</span> <span class="n">next_pt</span> <span class="p">!=</span> <span class="m">0</span> <span class="p">){</span>
    <span class="n">push</span><span class="p">(</span><span class="n">pts</span><span class="p">,</span> <span class="n">next_pt</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">foreach</span><span class="p">(</span> <span class="kt">int</span> <span class="n">pt</span><span class="p">;</span> <span class="n">pts</span> <span class="p">){</span>
    <span class="kt">int</span> <span class="n">connections</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">nbs</span><span class="na">[]</span> <span class="p">=</span> <span class="n">point</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;neighborhood&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">);</span>

    <span class="k">foreach</span><span class="p">(</span> <span class="kt">int</span> <span class="n">nbpt</span><span class="p">;</span> <span class="n">nbs</span> <span class="p">){</span>
        <span class="k">if</span><span class="p">(</span> <span class="n">inedgegroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;edges&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">nbpt</span><span class="p">)</span> <span class="p">){</span> <span class="c1">// If connected
</span><span class="c1"></span>            <span class="n">connections</span><span class="p">++;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span> <span class="n">connections</span> <span class="p">&gt;</span> <span class="m">1</span> <span class="p">){</span> <span class="c1">// If more than one connection
</span><span class="c1"></span>            <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">1</span><span class="p">);</span>
            <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span><span class="p">{</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">path_closing</span> <span class="p">!=</span> <span class="s">&#34;no_closing&#34;</span> <span class="p">){</span>
                <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">if</span><span class="p">(</span> <span class="n">inpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;closed&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">)</span> <span class="p">){</span>
        <span class="n">setpointgroup</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">&#34;active&#34;</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
<div class="caption">VEX code for the Set Closed Group node. This code polishes up any incorrect point groups.</div>
</p>

<h1 id="output">Output</h1>

<p>The final output of the solver is not lines, it&rsquo;s actually an edge group. This lets you receive your geometry unharmed, if that&rsquo;s what you need. Mostly though, the edge group is used to create polylines out of each path.
Later, temporary attributes and groups are cleaned up, unless otherwise decided.
<div class="project-image" oncontextmenu="return false;">
  <label for="lightbox-toggle3"><img src="/images/edgewalker-03.jpg"></label><div class="caption">Output network for post-processing.</div></div>
<input type="checkbox" name="lightbox-toggle3" id="lightbox-toggle3" />
<div class="lightbox" oncontextmenu="return false;">
  <label for="lightbox-toggle3"><img src="/images/edgewalker-03.jpg"><div class="caption">Output network for post-processing.</div></label>
</div>
</p>

    

    <div id="related">
      <span>Find other</span>
        
        <a href="/tags/houdini">
          houdini
        </a>
        <a href="/tags/procedural">
          procedural
        </a>
        <a href="/tags/tool">
          tool
        </a>projects<span>, or look in the
        <a href="/tags/">
          Tag Cloud
        </a>
      </span>
    </div>

  </div>

  <div id="return-bottom">
    <a href="http://bluevisual.tv/">Return to Project Grid</a>
</div>


</div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44698112-1', 'auto');
  ga('send', 'pageview');
</script>

  </body>
</html>

